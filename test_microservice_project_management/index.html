<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Proyectos - Dashboard</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <div class="app-container">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="sidebar-brand-icon">‚úì</div>
                <div class="sidebar-brand-text">PMO System</div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="sidebar-section">
                    <div class="sidebar-menu-item active">
                        <span class="sidebar-menu-icon">üè†</span>
                        <span class="sidebar-menu-text">Inicio</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üìä</span>
                        <span class="sidebar-menu-text">Dashboard</span>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Gesti√≥n</div>
                    <div class="sidebar-menu-item" onclick="window.location.href='pages/listar-proyectos.html'">
                        <span class="sidebar-menu-icon">üìÅ</span>
                        <span class="sidebar-menu-text">Proyectos</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üìù</span>
                        <span class="sidebar-menu-text">Contratos</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üë•</span>
                        <span class="sidebar-menu-text">Contratistas</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üìÑ</span>
                        <span class="sidebar-menu-text">Documentos</span>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Reportes</div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üìà</span>
                        <span class="sidebar-menu-text">Financiero</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">‚è±Ô∏è</span>
                        <span class="sidebar-menu-text">Seguimiento</span>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Sistema</div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">‚öôÔ∏è</span>
                        <span class="sidebar-menu-text">Configuraci√≥n</span>
                    </div>
                    <div class="sidebar-menu-item">
                        <span class="sidebar-menu-icon">üë§</span>
                        <span class="sidebar-menu-text">Usuarios</span>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- MAIN CONTENT -->
        <div class="main-content">
            <!-- HEADER -->
            <header class="app-header">
                <div class="header-left">
                    <h1 class="header-title">Inicio</h1>
                    <div class="header-tabs">
                        <a href="#" class="header-tab active">Resumen</a>
                        <a href="#" class="header-tab">Finanzas</a>
                        <a href="#" class="header-tab">Actividad</a>
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="header-icon-btn">üîç</button>
                    <button class="header-icon-btn">üîî</button>
                    <button class="header-icon-btn">üí¨</button>
                    <div class="header-user">
                        <div class="header-user-avatar">U</div>
                    </div>
                </div>
            </header>

            <!-- PAGE CONTENT -->
            <main class="page-content">
                <!-- STATS -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon primary">üìä</div>
                        <div class="stat-content">
                            <div class="stat-label">Total Proyectos</div>
                            <div class="stat-value" id="totalProyectos">0</div>
                            <div class="stat-change positive">‚Üë 12% este mes</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon success">‚úì</div>
                        <div class="stat-content">
                            <div class="stat-label">Activos</div>
                            <div class="stat-value" id="proyectosActivos">0</div>
                            <div class="stat-change positive">‚Üë 8% este mes</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon warning">üí∞</div>
                        <div class="stat-content">
                            <div class="stat-label">Valor Total</div>
                            <div class="stat-value" id="valorTotal">$0</div>
                            <div class="stat-change positive">‚Üë 15% este mes</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon primary">üìÖ</div>
                        <div class="stat-content">
                            <div class="stat-label">En Ejecuci√≥n</div>
                            <div class="stat-value" id="proyectosEjecucion">0</div>
                            <div class="stat-change">Sin cambios</div>
                        </div>
                    </div>
                </div>

                <!-- ACTIONS BAR -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                    <h2 style="font-size: 1.25rem; font-weight: 600;">Proyectos Recientes</h2>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary btn-sm">
                            üìä Exportar
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="window.location.href='pages/crear-proyecto.html'">
                            ‚ûï Nuevo Proyecto
                        </button>
                    </div>
                </div>

                <!-- TABLA DE PROYECTOS -->
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Proyecto</th>
                                <th>Estado</th>
                                <th>Valor</th>
                                <th>Inicio</th>
                                <th>Progreso</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody">
                            <tr>
                                <td colspan="7">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üì≠</div>
                                        <div class="empty-state-title">No hay proyectos</div>
                                        <div class="empty-state-description">
                                            Comience creando su primer proyecto
                                        </div>
                                        <button class="btn btn-primary" onclick="window.location.href='pages/crear-proyecto.html'">
                                            Crear Proyecto
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </main>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script>
        // Cargar estad√≠sticas
        function cargarEstadisticas() {
            const proyectos = obtenerProyectos();
            
            document.getElementById('totalProyectos').textContent = proyectos.length;
            
            const activos = proyectos.filter(p => p.es_activo).length;
            document.getElementById('proyectosActivos').textContent = activos;
            
            const enEjecucion = proyectos.filter(p => p.estado_proyecto_id === '14').length;
            document.getElementById('proyectosEjecucion').textContent = enEjecucion;
            
            const total = proyectos.reduce((sum, p) => sum + parseFloat(p.valor_proyecto || 0), 0);
            document.getElementById('valorTotal').textContent = formatearMoneda(total);
        }

        // Obtener nombre del estado
        function obtenerNombreEstado(estadoId) {
            const estados = {
                '0': { nombre: 'EN ESTUDIO', clase: 'gray' },
                '2': { nombre: 'FORMULADO', clase: 'primary' },
                '4': { nombre: 'PRE-APROBADO', clase: 'warning' },
                '6': { nombre: 'APROBADO', clase: 'success' },
                '8': { nombre: 'SUSCRITO', clase: 'success' },
                '12': { nombre: 'SIN INICIAR', clase: 'warning' },
                '14': { nombre: 'EN EJECUCI√ìN', clase: 'primary' }
            };
            return estados[estadoId] || { nombre: 'DESCONOCIDO', clase: 'gray' };
        }

        // Cargar tabla de proyectos
        function cargarTablaProyectos() {
            const proyectos = obtenerProyectos();
            const tbody = document.getElementById('projectsTableBody');
            
            if (proyectos.length === 0) {
                return; // Mantener empty state
            }
            
            // Mostrar solo los √∫ltimos 5
            const proyectosRecientes = proyectos.slice(-5).reverse();
            
            tbody.innerHTML = proyectosRecientes.map(proyecto => {
                const estado = obtenerNombreEstado(proyecto.estado_proyecto_id);
                const fechaInicio = new Date(proyecto.fecha_inicio);
                const fechaFin = new Date(proyecto.fecha_finalizacion);
                const hoy = new Date();
                
                // Calcular progreso simple
                const total = fechaFin - fechaInicio;
                const transcurrido = hoy - fechaInicio;
                const progreso = Math.max(0, Math.min(100, Math.round((transcurrido / total) * 100)));
                
                return `
                    <tr>
                        <td><strong>#${proyecto.proyecto_id}</strong></td>
                        <td>
                            <div style="font-weight: 500;">${proyecto.nombre_proyecto}</div>
                            <div style="font-size: 0.75rem; color: var(--text-tertiary);">
                                ${proyecto.anio_proyecto}
                            </div>
                        </td>
                        <td>
                            <span class="badge badge-${estado.clase}">${estado.nombre}</span>
                        </td>
                        <td style="font-weight: 500;">${formatearMoneda(proyecto.valor_proyecto)}</td>
                        <td>${formatearFecha(proyecto.fecha_inicio)}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div style="flex: 1; height: 6px; background: var(--bg-tertiary); border-radius: 999px; overflow: hidden;">
                                    <div style="height: 100%; width: ${progreso}%; background: var(--primary-color); transition: width 0.3s;"></div>
                                </div>
                                <span style="font-size: 0.75rem; color: var(--text-secondary); min-width: 35px;">${progreso}%</span>
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-ghost btn-sm" onclick="window.location.href='pages/detalle-proyecto.html?id=${proyecto.proyecto_id}'">
                                Ver ‚Üí
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // Inicializar
        cargarEstadisticas();
        cargarTablaProyectos();

        // Navegaci√≥n del sidebar
        document.querySelectorAll('.sidebar-menu-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.sidebar-menu-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
</body>
</html>