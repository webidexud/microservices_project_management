<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Proyecto - Gestión de Proyectos</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/main.css">
    <style>
        /* Estilos específicos del formulario */
        .page-container {
            max-width: 900px;
            margin: var(--spacing-lg) auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .page-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
        }

        .page-header h1 {
            font-size: 1.8rem;
            margin-bottom: var(--spacing-xs);
        }

        .page-header p {
            opacity: 0.9;
        }

        .form-container {
            padding: var(--spacing-lg);
        }

        .form-section {
            margin-bottom: var(--spacing-xl);
        }

        .form-section h2 {
            color: var(--primary-color);
            font-size: 1.3rem;
            margin-bottom: var(--spacing-md);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: var(--spacing-xs);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .char-counter {
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: right;
            margin-top: 4px;
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
            padding-top: var(--spacing-md);
            border-top: 2px solid var(--border-color);
            margin-top: var(--spacing-lg);
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: var(--spacing-md);
        }

        .project-id {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: var(--spacing-md) 0;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .form-container {
                padding: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="container">
            <h1 class="navbar-brand">🚀 Gestión de Proyectos</h1>
            <ul class="navbar-menu">
                <li><a href="../index.html">Inicio</a></li>
                <li><a href="listar-proyectos.html">Proyectos</a></li>
                <li><a href="crear-proyecto.html" class="active">Crear Proyecto</a></li>
            </ul>
        </div>
    </nav>

    <!-- FORMULARIO -->
    <div class="page-container">
        <div class="page-header">
            <h1>📝 Crear Nuevo Proyecto</h1>
            <p>Complete todos los campos obligatorios marcados con (*)</p>
        </div>

        <div class="form-container">
            <form id="proyectoForm">
                
                <!-- SECCIÓN 1: INFORMACIÓN GENERAL -->
                <div class="form-section">
                    <h2>📋 Información General</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Año del Proyecto <span class="required">*</span></label>
                            <input type="number" id="anio_proyecto" name="anio_proyecto" required min="2020" max="2030">
                        </div>
                        
                        <div class="form-group">
                            <label>Número Proyecto Externo</label>
                            <input type="text" id="numero_proyecto_externo" name="numero_proyecto_externo" maxlength="20" placeholder="Ej: CONV-2024-001">
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>Nombre del Proyecto <span class="required">*</span></label>
                        <input type="text" id="nombre_proyecto" name="nombre_proyecto" required maxlength="800" placeholder="Ingrese el nombre completo del proyecto">
                        <div class="char-counter"><span id="nombre_counter">0</span>/800 caracteres</div>
                    </div>

                    <div class="form-group full-width">
                        <label>Objeto del Proyecto <span class="required">*</span></label>
                        <textarea id="objeto_proyecto" name="objeto_proyecto" required placeholder="Describa el objeto y propósito del proyecto"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Entidad <span class="required">*</span></label>
                            <select id="entidad_id" name="entidad_id" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Ministerio de Educación Nacional</option>
                                <option value="2">SENA</option>
                                <option value="3">Alcaldía Mayor de Bogotá</option>
                                <option value="4">Colciencias - Minciencias</option>
                                <option value="5">Empresa Privada ABC S.A.S</option>
                                <option value="6">Gobernación de Cundinamarca</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Dependencia Ejecutora <span class="required">*</span></label>
                            <select id="dependencia_ejecutora_id" name="dependencia_ejecutora_id" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Facultad de Ingeniería</option>
                                <option value="2">Facultad de Ciencias y Educación</option>
                                <option value="3">Facultad de Artes - ASAB</option>
                                <option value="4">Facultad Tecnológica</option>
                                <option value="5">Facultad de Medio Ambiente</option>
                                <option value="6">Oficina de Extensión</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN 2: CLASIFICACIÓN -->
                <div class="form-section">
                    <h2>📊 Clasificación del Proyecto</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Estado del Proyecto <span class="required">*</span></label>
                            <select id="estado_proyecto_id" name="estado_proyecto_id" required>
                                <option value="">Seleccione...</option>
                                <option value="0">EN ESTUDIO</option>
                                <option value="2">FORMULADO</option>
                                <option value="4">PRE-APROBADO</option>
                                <option value="6">APROBADO COMITÉ CENTRAL</option>
                                <option value="8">SUSCRITO</option>
                                <option value="12">SIN INICIAR</option>
                                <option value="14">EN EJECUCIÓN</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Tipo de Proyecto <span class="required">*</span></label>
                            <select id="tipo_proyecto_id" name="tipo_proyecto_id" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Consultoría</option>
                                <option value="2">Investigación Aplicada</option>
                                <option value="3">Capacitación y Formación</option>
                                <option value="4">Desarrollo Tecnológico</option>
                                <option value="5">Extensión Social</option>
                                <option value="6">Asistencia Técnica</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Modalidad de Ejecución <span class="required">*</span></label>
                            <select id="modalidad_ejecucion_id" name="modalidad_ejecucion_id" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Directa</option>
                                <option value="2">Indirecta</option>
                                <option value="3">Mixta</option>
                                <option value="4">Cofinanciación</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Modalidad de Contratación</label>
                            <select id="modalidad_contratacion_id" name="modalidad_contratacion_id">
                                <option value="">Seleccione...</option>
                                <option value="1">Licitación Pública</option>
                                <option value="2">Selección Abreviada</option>
                                <option value="3">Contratación Directa</option>
                                <option value="4">Mínima Cuantía</option>
                                <option value="5">Concurso de Méritos</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tipo de Financiación <span class="required">*</span></label>
                        <select id="tipo_financiacion_id" name="tipo_financiacion_id" required>
                            <option value="">Seleccione...</option>
                            <option value="1">Recursos Propios</option>
                            <option value="2">Recursos Externos</option>
                            <option value="3">Cofinanciación</option>
                            <option value="4">Donación</option>
                            <option value="5">Recursos SGR</option>
                        </select>
                    </div>
                </div>

                <!-- SECCIÓN 3: INFORMACIÓN ECONÓMICA -->
                <div class="form-section">
                    <h2>💰 Información Económica</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor del Proyecto (COP) <span class="required">*</span></label>
                            <input type="number" id="valor_proyecto" name="valor_proyecto" required min="1" step="0.01" placeholder="0.00">
                        </div>

                        <div class="form-group">
                            <label>Aporte Entidad (COP)</label>
                            <input type="number" id="aporte_entidad" name="aporte_entidad" min="0" step="0.01" placeholder="0.00" value="0">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Aporte Universidad (COP)</label>
                            <input type="number" id="aporte_universidad" name="aporte_universidad" min="0" step="0.01" placeholder="0.00" value="0">
                        </div>

                        <div class="form-group">
                            <label>Cantidad de Beneficiarios</label>
                            <input type="number" id="cantidad_beneficiarios" name="cantidad_beneficiarios" min="0" placeholder="0">
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN 4: FECHAS -->
                <div class="form-section">
                    <h2>📅 Información Temporal</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha de Suscripción</label>
                            <input type="date" id="fecha_suscripcion" name="fecha_suscripcion">
                        </div>

                        <div class="form-group">
                            <label>Funcionario Ordenador <span class="required">*</span></label>
                            <select id="funcionario_ordenador_id" name="funcionario_ordenador_id" required>
                                <option value="">Seleccione...</option>
                                <option value="1">Dr. Juan Carlos Pérez - Rector</option>
                                <option value="2">Dra. María Elena García - Vicerrectora Académica</option>
                                <option value="3">Dr. Carlos Andrés López - Vicerrector Administrativo</option>
                                <option value="4">Dra. Ana María Rodríguez - Decana Ingeniería</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Fecha de Inicio <span class="required">*</span></label>
                            <input type="date" id="fecha_inicio" name="fecha_inicio" required>
                        </div>

                        <div class="form-group">
                            <label>Fecha de Finalización <span class="required">*</span></label>
                            <input type="date" id="fecha_finalizacion" name="fecha_finalizacion" required>
                        </div>
                    </div>
                </div>

                <!-- SECCIÓN 5: INFORMACIÓN ADICIONAL -->
                <div class="form-section">
                    <h2>📄 Información Adicional</h2>
                    
                    <div class="form-group">
                        <label>Correo Principal</label>
                        <input type="email" id="correo_principal" name="correo_principal" placeholder="correo@udistrital.edu.co">
                    </div>

                    <div class="form-group">
                        <label>Enlace SECOP</label>
                        <input type="url" id="enlace_secop" name="enlace_secop" placeholder="https://www.colombiacompra.gov.co/...">
                    </div>

                    <div class="form-group">
                        <label>Acto Administrativo</label>
                        <input type="text" id="acto_administrativo" name="acto_administrativo" maxlength="50" placeholder="Resolución o acto que respalda el proyecto">
                    </div>

                    <div class="form-group">
                        <label>Observaciones</label>
                        <textarea id="observaciones" name="observaciones" placeholder="Observaciones generales del proyecto"></textarea>
                    </div>
                </div>

                <!-- BOTONES -->
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="cancelarFormulario()">Cancelar</button>
                    <button type="submit" class="btn btn-primary">✅ Crear Proyecto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL DE ÉXITO -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="success-icon">✅</div>
            <h3>¡Proyecto Creado Exitosamente!</h3>
            <div class="project-id" id="projectIdDisplay">#0</div>
            <p>El proyecto ha sido registrado correctamente en el sistema.</p>
            <button class="btn btn-primary" onclick="cerrarModal()">Aceptar</button>
        </div>
    </div>

    <script src="../js/config.js"></script>
    <script src="../js/utils.js"></script>
    <script src="../js/proyectos.js"></script>
    <script>
        // Auto-rellenar año actual
        document.getElementById('anio_proyecto').value = CONFIG.CURRENT_YEAR;

        // Contador de caracteres
        const nombreInput = document.getElementById('nombre_proyecto');
        const nombreCounter = document.getElementById('nombre_counter');
        
        nombreInput.addEventListener('input', function() {
            nombreCounter.textContent = this.value.length;
        });

        // Manejo del formulario
        document.getElementById('proyectoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            try {
                // Obtener datos del formulario
                const formData = new FormData(this);
                const datos = {};
                formData.forEach((value, key) => {
                    datos[key] = value || null;
                });

                // Validar fechas
                validarFechas(datos.fecha_inicio, datos.fecha_finalizacion);

                // Validar valores
                validarValores(
                    parseFloat(datos.valor_proyecto),
                    parseFloat(datos.aporte_entidad) || 0,
                    parseFloat(datos.aporte_universidad) || 0
                );

                // Crear proyecto
                const proyecto = crearProyecto(datos);

                // Mostrar modal de éxito
                document.getElementById('projectIdDisplay').textContent = `#${proyecto.proyecto_id}`;
                document.getElementById('successModal').classList.add('show');

                console.log('✅ Proyecto creado:', proyecto);

            } catch (error) {
                mostrarNotificacion('❌ ' + error.message, 'error');
            }
        });

        function cancelarFormulario() {
            if (confirm('¿Está seguro que desea cancelar? Se perderán todos los datos ingresados.')) {
                window.location.href = '../index.html';
            }
        }

        function cerrarModal() {
            document.getElementById('successModal').classList.remove('show');
            window.location.href = 'listar-proyectos.html';
        }
    </script>
</body>
</html>